<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Marketing Blueprint - Your Free Strategy Awaits</title>

    <!-- HubSpot Tracking Code with Enhanced Loading & Network Diagnostics -->
    <script type="text/javascript">
        // Global HubSpot loading state with enhanced diagnostics
        window.hubspotLoadingAttempts = 0;
        window.hubspotMaxAttempts = 5;
        window.hubspotLoadingInterval = null;
        window.hubspotDiagnostics = {
            networkTests: [],
            scriptTests: [],
            loadingMethod: 'unknown',
            fallbackReason: null,
            timestamp: new Date().toISOString()
        };

        // Network connectivity test function
        async function testNetworkConnectivity() {
            const tests = [
                {
                    name: 'HubSpot CDN Primary',
                    url: 'https://js.hubspot.com/web-interactives-embed.js',
                    method: 'HEAD'
                },
                {
                    name: 'HubSpot CDN Script',
                    url: 'https://js.hubspot.com/forms/embed/v2.js',
                    method: 'HEAD'
                },
                {
                    name: 'HubSpot API',
                    url: 'https://api.hubapi.com/health/v3/status',
                    method: 'GET'
                },
                {
                    name: 'Google CDN Test',
                    url: 'https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js',
                    method: 'HEAD'
                }
            ];

            console.log('üîç Running network connectivity tests...');

            for (const test of tests) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(test.url, { 
                        method: test.method,
                        mode: 'no-cors',  // Avoid CORS issues
                        cache: 'no-cache',
                        signal: AbortSignal.timeout(10000)  // 10 second timeout
                    });

                    const duration = Date.now() - startTime;
                    const result = {
                        name: test.name,
                        url: test.url,
                        status: 'SUCCESS',
                        responseTime: duration,
                        details: `Response in ${duration}ms`
                    };

                    window.hubspotDiagnostics.networkTests.push(result);
                    console.log(`‚úÖ ${test.name}: ${result.details}`);

                } catch (error) {
                    const result = {
                        name: test.name,
                        url: test.url,
                        status: 'FAILED',
                        error: error.message,
                        details: `Error: ${error.message}`
                    };

                    window.hubspotDiagnostics.networkTests.push(result);
                    console.log(`‚ùå ${test.name}: ${result.details}`);
                }
            }

            // Test alternative protocols
            await testAlternativeProtocols();
        }

        // Test alternative loading protocols
        async function testAlternativeProtocols() {
            const alternatives = [
                'https://js.hubspot.com/web-interactives-embed.js',
                'https://js.hs-scripts.com/web-interactives-embed.js',
                'https://js.hs-analytics.net/web-interactives-embed.js'
            ];

            console.log('üîÑ Testing alternative CDN endpoints...');

            for (const url of alternatives) {
                try {
                    const response = await fetch(url, { 
                        method: 'HEAD', 
                        mode: 'no-cors',
                        signal: AbortSignal.timeout(5000)
                    });

                    window.hubspotDiagnostics.scriptTests.push({
                        url: url,
                        status: 'ACCESSIBLE',
                        note: 'Alternative endpoint responding'
                    });

                    console.log(`‚úÖ Alternative CDN accessible: ${url}`);

                } catch (error) {
                    window.hubspotDiagnostics.scriptTests.push({
                        url: url,
                        status: 'FAILED',
                        error: error.message
                    });

                    console.log(`‚ùå Alternative CDN failed: ${url} - ${error.message}`);
                }
            }
        }

        // Enhanced script loading with multiple fallbacks
        function loadHubSpotScript() {
            const portalId = "47877786";
            const scriptUrls = [
                `https://js.hubspot.com/web-interactives-embed.js`,
                `https://js.hs-scripts.com/web-interactives-embed.js`,
                `https://js.hs-analytics.net/web-interactives-embed.js`
            ];

            let currentUrlIndex = 0;

            function tryLoadScript(urlIndex = 0) {
                if (urlIndex >= scriptUrls.length) {
                    console.log('‚ùå All script URLs failed, falling back to iframe');
                    window.hubspotDiagnostics.fallbackReason = 'All script URLs failed';
                    loadHubSpotIframeFallback();
                    return;
                }

                const script = document.createElement('script');
                const currentUrl = scriptUrls[urlIndex];

                script.type = 'text/javascript';
                script.src = currentUrl;
                script.async = true;
                script.defer = true;

                console.log(`üîÑ Attempting to load HubSpot script from: ${currentUrl}`);

                script.onload = function() {
                    console.log(`‚úÖ HubSpot script loaded successfully from: ${currentUrl}`);
                    window.hubspotDiagnostics.loadingMethod = 'script';
                    window.hubspotDiagnostics.scriptTests.push({
                        url: currentUrl,
                        status: 'LOADED',
                        note: 'Successfully loaded and executed'
                    });

                    // Try to initialize HubSpot forms
                    initializeHubSpotForms();
                };

                script.onerror = function(error) {
                    console.log(`‚ùå Failed to load HubSpot script from: ${currentUrl}`);
                    window.hubspotDiagnostics.scriptTests.push({
                        url: currentUrl,
                        status: 'FAILED',
                        error: 'Script load error'
                    });

                    // Try next URL
                    setTimeout(() => tryLoadScript(urlIndex + 1), 1000);
                };

                // Timeout fallback
                setTimeout(() => {
                    if (!window.hbspt) {
                        console.log(`‚è∞ Timeout loading script from: ${currentUrl}`);
                        script.onerror(new Error('Timeout'));
                    }
                }, 8000);

                document.head.appendChild(script);
            }

            // Start loading attempts
            tryLoadScript(0);
        }

        // Enhanced HubSpot forms initialization
        function initializeHubSpotForms() {
            let attempts = 0;
            const maxAttempts = 10;

            function checkAndInitialize() {
                attempts++;

                if (window.hbspt && window.hbspt.forms) {
                    console.log('‚úÖ HubSpot forms API available, creating forms');
                    createHubSpotForms();
                    window.hubspotDiagnostics.loadingMethod = 'script-success';
                    return;
                }

                if (attempts < maxAttempts) {
                    console.log(`üîÑ HubSpot forms API not ready, attempt ${attempts}/${maxAttempts}`);
                    setTimeout(checkAndInitialize, 500);
                } else {
                    console.log('‚ùå HubSpot forms API never became available, using iframe fallback');
                    window.hubspotDiagnostics.fallbackReason = 'Forms API not available';
                    loadHubSpotIframeFallback();
                }
            }

            checkAndInitialize();
        }

        // Create HubSpot forms when API is available
        function createHubSpotForms() {
            const portalId = "47877786";
            const formId = "5ecb4e47-7e23-42a4-bb59-71249acded4f";

            try {
                // Main form
                if (document.getElementById('hubspot-form-main')) {
                    window.hbspt.forms.create({
                        region: "na1",
                        portalId: portalId,
                        formId: formId,
                        target: '#hubspot-form-main',
                        onFormReady: function() {
                            console.log('‚úÖ Main HubSpot form loaded successfully');
                        },
                        onFormSubmit: function() {
                            console.log('üìù Main form submitted');
                        }
                    });
                }

                // Footer form
                if (document.getElementById('hubspot-form-footer')) {
                    window.hbspt.forms.create({
                        region: "na1",
                        portalId: portalId,
                        formId: formId,
                        target: '#hubspot-form-footer',
                        onFormReady: function() {
                            console.log('‚úÖ Footer HubSpot form loaded successfully');
                        },
                        onFormSubmit: function() {
                            console.log('üìù Footer form submitted');
                        }
                    });
                }

            } catch (error) {
                console.error('‚ùå Error creating HubSpot forms:', error);
                window.hubspotDiagnostics.fallbackReason = `Form creation error: ${error.message}`;
                loadHubSpotIframeFallback();
            }
        }

        // Enhanced iframe fallback with better implementation
        function loadHubSpotIframeFallback() {
            console.log('üîÑ Loading HubSpot iframe fallback...');
            window.hubspotDiagnostics.loadingMethod = 'iframe-fallback';

            const portalId = "47877786";
            const formId = "5ecb4e47-7e23-42a4-bb59-71249acded4f";
            const region = "na1";

            // Enhanced iframe with better styling and error handling
            const iframeHtml = `
                <div class="hubspot-iframe-container" style="
                    width: 100%;
                    max-width: 500px;
                    margin: 0 auto;
                    padding: 20px;
                    border: 1px solid #e1e5e9;
                    border-radius: 8px;
                    background: #ffffff;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                ">
                    <iframe 
                        src="https://share.hsforms.com/1${formId}/${portalId}"
                        width="100%" 
                        height="500"
                        frameborder="0"
                        scrolling="auto"
                        style="border: none; border-radius: 4px;"
                        title="AI Marketing Blueprint Form"
                        loading="lazy"
                        onload="console.log('‚úÖ HubSpot iframe loaded successfully')"
                        onerror="console.log('‚ùå HubSpot iframe failed to load')"
                    ></iframe>
                    <div style="
                        margin-top: 10px;
                        font-size: 12px;
                        color: #666;
                        text-align: center;
                    ">
                        Secure form powered by HubSpot
                    </div>
                </div>
            `;

            // Replace form containers with iframes
            const containers = ['hubspot-form-main', 'hubspot-form-footer'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = iframeHtml;
                    console.log(`‚úÖ Iframe fallback applied to ${containerId}`);
                }
            });
        }

        // Display comprehensive diagnostics
        function displayDiagnostics() {
            console.log('üìä HubSpot Loading Diagnostics Report');
            console.log('=====================================');
            console.log(`Timestamp: ${window.hubspotDiagnostics.timestamp}`);
            console.log(`Loading Method: ${window.hubspotDiagnostics.loadingMethod}`);
            console.log(`Fallback Reason: ${window.hubspotDiagnostics.fallbackReason || 'None'}`);

            console.log('\nüåê Network Tests:');
            window.hubspotDiagnostics.networkTests.forEach(test => {
                console.log(`  ${test.status === 'SUCCESS' ? '‚úÖ' : '‚ùå'} ${test.name}: ${test.details}`);
            });

            console.log('\nüìú Script Tests:');
            window.hubspotDiagnostics.scriptTests.forEach(test => {
                console.log(`  ${test.status.includes('SUCCESS') || test.status === 'LOADED' ? '‚úÖ' : '‚ùå'} ${test.url}: ${test.status}`);
            });

            // Also create a visible diagnostic panel for debugging
            createDiagnosticPanel();
        }

        // Create visible diagnostic panel
        function createDiagnosticPanel() {
            const panel = document.createElement('div');
            panel.id = 'hubspot-diagnostics';
            panel.style.cssText = `
                position: fixed;
                top: 10px;
                right: 10px;
                width: 300px;
                max-height: 400px;
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 15px;
                font-family: monospace;
                font-size: 12px;
                z-index: 10000;
                overflow-y: auto;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;

            let html = `
                <div style="font-weight: bold; margin-bottom: 10px; color: #495057;">
                    üîç HubSpot Diagnostics
                </div>
                <div><strong>Method:</strong> ${window.hubspotDiagnostics.loadingMethod}</div>
                <div><strong>Time:</strong> ${new Date().toLocaleTimeString()}</div>
            `;

            if (window.hubspotDiagnostics.fallbackReason) {
                html += `<div style="color: #dc3545;"><strong>Fallback:</strong> ${window.hubspotDiagnostics.fallbackReason}</div>`;
            }

            html += '<div style="margin: 10px 0; font-weight: bold;">Network Tests:</div>';
            window.hubspotDiagnostics.networkTests.forEach(test => {
                const color = test.status === 'SUCCESS' ? '#28a745' : '#dc3545';
                html += `<div style="color: ${color};">‚Ä¢ ${test.name}: ${test.status}</div>`;
            });

            html += '<div style="margin: 10px 0; font-weight: bold;">Script Tests:</div>';
            window.hubspotDiagnostics.scriptTests.forEach(test => {
                const color = test.status === 'LOADED' || test.status === 'ACCESSIBLE' ? '#28a745' : '#dc3545';
                html += `<div style="color: ${color};">‚Ä¢ ${test.status}</div>`;
            });

            html += `
                <button onclick="this.parentElement.remove()" style="
                    margin-top: 10px;
                    padding: 5px 10px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                ">Close</button>
            `;

            panel.innerHTML = html;
            document.body.appendChild(panel);
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Starting HubSpot integration with enhanced diagnostics...');

            // Run network tests first
            await testNetworkConnectivity();

            // Then try to load HubSpot script
            loadHubSpotScript();

            // Display diagnostics after a delay
            setTimeout(displayDiagnostics, 15000);
        });

        // Also run tests immediately if DOM is already loaded
        if (document.readyState === 'loading') {
            // DOM is still loading, wait for DOMContentLoaded
        } else {
            // DOM is already loaded, run immediately
            setTimeout(async () => {
                console.log('üöÄ Starting HubSpot integration (immediate)...');
                await testNetworkConnectivity();
                loadHubSpotScript();
                setTimeout(displayDiagnostics, 15000);
            }, 100);
        }
    </script>
</head>
<body><body>
    <div class="tech-grid"></div>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <div class="floating-animation">
                <h1 class="neon-text">AI Marketing Blueprint</h1>
                <p class="subtitle">Get Your Free Personalized AI Strategy in 60 Seconds</p>
                <button class="cta-button" onclick="showForm()">
                    ‚ö° Start Your Free AI Analysis
                </button>
            </div>
        </section>

        <!-- Form Section -->
        <section id="form-section" class="form-section hidden">
            <div class="form-container">
                <h2 class="form-title">Get Your Personalized AI Strategy</h2>
                <p class="form-subtitle">Tell us about your business and get instant AI recommendations</p>

                <div id="hubspot-form-container">
                    <!-- HubSpot form will be loaded here -->
                    <div style="text-align: center; padding: 40px; color: #00ffff;">
                        <p>üîÑ Loading your personalized form...</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Debug Console -->
    <div id="debug-console" class="debug-console">
        üî¨ <strong>HUBSPOT FIX CONSOLE</strong><br>
        <div id="debug-log">Starting HubSpot diagnostic analysis...</div>
    </div>

    <script>
        // Enhanced debugging system
        function debugLog(message) {
            const debugElement = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            debugElement.innerHTML += `<br>[${timestamp}] ${message}`;
            debugElement.scrollTop = debugElement.scrollHeight;
            console.log(`[HUBSPOT FIX] ${message}`);
        }

        // Enhanced form visibility function with HubSpot integration
        function showForm() {
            debugLog("üöÄ CTA button clicked - starting enhanced form display");

            // FIRST: Show the form section BEFORE scrolling
            const formSection = document.getElementById('form-section');
            formSection.classList.remove('hidden');
            formSection.classList.add('force-visible');

            // THEN: Smooth scroll to the now-visible form section
            setTimeout(() => {
                formSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'center'  // Center the form in viewport
                });

                debugLog("üìç Form section shown, scrolling to form...");

                setTimeout(() => {
                    debugLog("üìç Scroll completed, initializing HubSpot form...");

                    // Add debug visual indicators
                    const formContainer = document.getElementById('hubspot-form-container');
                    formContainer.classList.add('debug-visible');

                    // Create HubSpot form using proper API
                    initializeHubSpotForm();

                    // Show success indicator
                    showDebugMessage("HUBSPOT FORM INITIALIZATION STARTED!");

                }, 800);  // Allow time for scroll animation
            }, 100);  // Small delay to ensure visibility change is processed
        }

                function initializeHubSpotForm() {
            debugLog("üîß Initializing HubSpot form with enhanced loading verification...");

            // Enhanced Portal ID verification
            debugLog("üÜî Using Portal ID: 242797301 (User's verified Portal ID)");
            debugLog("üìã Form ID: 2t_CyZSa6RnarClD9P3IyFw");
            debugLog("üåç Region: na1");

            // Use the new loading verification system
            if (!isHubSpotReady()) {
                debugLog("‚è≥ HubSpot not ready yet, waiting for it to load...");

                // Wait for HubSpot to be ready
                waitForHubSpot((success) => {
                    if (success) {
                        debugLog("‚úÖ HubSpot is now ready, creating form...");
                        createHubSpotForm();
                    } else {
                        debugLog("‚ùå HubSpot failed to load, showing fallback...");
                        loadHubSpotFallback();
                    }
                }, 15, 500); // Wait up to 15 attempts, 500ms apart = 7.5 seconds max
                return;
            }

            debugLog("‚úÖ HubSpot script already ready, creating form immediately...");
            createHubSpotForm();
        }

        function createHubSpotForm() {
            debugLog("üéØ Creating HubSpot form...");

            try {
                // Use HubSpot's recommended form creation method
                hbspt.forms.create({
                    region: "na1",
                    portalId: "242797301", // Extracted from tracking code
                    formId: "2t_CyZSa6RnarClD9P3IyFw", // From original URL
                    target: "#hubspot-form-container",
                    onFormReady: function() {
                        debugLog("‚úÖ HubSpot form loaded successfully!");
                        showDebugMessage("SUCCESS: HUBSPOT FORM IS READY!");

                        // Hide loading indicator
                        const loadingDiv = document.querySelector('.loading-form');
                        if (loadingDiv) {
                            loadingDiv.style.display = 'none';
                        }

                        // Show form with animation
                        const formContainer = document.getElementById('hubspot-form-container');
                        formContainer.style.opacity = '0';
                        formContainer.style.transform = 'translateY(20px)';
                        formContainer.style.transition = 'all 0.5s ease';

                        setTimeout(() => {
                            formContainer.style.opacity = '1';
                            formContainer.style.transform = 'translateY(0)';
                        }, 100);
                    },
                    onFormSubmit: function() {
                        debugLog("üì§ Form submitted successfully!");
                        showDebugMessage("FORM SUBMITTED SUCCESSFULLY!");
                    },
                    onFormSubmitted: function() {
                        debugLog("‚úÖ Form submission confirmed!");
                        showDebugMessage("SUBMISSION CONFIRMED - THANK YOU!");

                        // Hide form and show thank you message
                        setTimeout(() => {
                            const formSection = document.getElementById('form-section');
                            formSection.innerHTML = `
                                <div class="thank-you-message" style="text-align: center; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white;">
                                    <h2>üéâ Thank You!</h2>
                                    <p>Your information has been submitted successfully. We'll be in touch soon!</p>
                                </div>
                            `;
                        }, 1000);
                    }
                });

            } catch (error) {
                debugLog("‚ùå Error creating HubSpot form: " + error.message);
                console.error("HubSpot form creation error:", error);
                loadHubSpotFallback();
            }
        }

        function loadHubSpotFallback() {
            debugLog("üîÑ Loading HubSpot fallback method...");

            const container = document.getElementById('hubspot-form-container');

            // Fallback iframe method
            const iframe = document.createElement('iframe');
            iframe.src = 'https://40jzlh.share-na2.hsforms.com/2t_CyZSa6RnarClD9P3IyFw';
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.style.border = 'none';
            iframe.style.borderRadius = '15px';

            container.innerHTML = '';
            container.appendChild(iframe);

            debugLog("üìã Fallback iframe method implemented");
            showDebugMessage("FALLBACK FORM METHOD LOADED!");
        }

        function applyCustomStyling() {
            debugLog("üé® Applying custom cyberpunk styling...");

            // Additional custom styling for HubSpot form elements
            const formElements = document.querySelectorAll('#hubspot-form-container input, #hubspot-form-container select, #hubspot-form-container textarea');
            formElements.forEach(element => {
                element.style.background = 'rgba(0, 128, 255, 0.1)';
                element.style.border = '2px solid #0080ff';
                element.style.color = '#ffffff';
                element.style.borderRadius = '8px';
                element.style.padding = '12px';
            });

            debugLog("‚ú® Custom styling applied successfully");
        }

        function showDebugMessage(text) {
            // Remove any existing debug message
            const existing = document.querySelector('.debug-message');
            if (existing) existing.remove();

            // Create new debug message
            const debugDiv = document.createElement('div');
            debugDiv.className = 'debug-message';
            debugDiv.textContent = text;
            document.body.appendChild(debugDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (debugDiv.parentNode) {
                    debugDiv.parentNode.removeChild(debugDiv);
                }
            }, 5000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            debugLog("üìÑ Page loaded, checking HubSpot script status...");

            // Check HubSpot script loading status
            setTimeout(() => {
                if (typeof hbspt !== 'undefined') {
                    debugLog("‚úÖ HubSpot script loaded successfully");
                } else {
                    debugLog("‚ö†Ô∏è HubSpot script not yet loaded, will retry when needed");
                }
            }, 2000);
        });

        // Additional script loading verification
        window.addEventListener('load', function() {
            debugLog("üåê Window fully loaded, final HubSpot check...");

            setTimeout(() => {
                const hubspotScript = document.getElementById('hs-script-loader');
                if (hubspotScript) {
                    debugLog("üìú HubSpot tracking script element found");
                } else {
                    debugLog("‚ùå HubSpot tracking script element missing");
                }
            }, 1000);
        });
    </script>

    <!-- Domain Whitelist Instructions (Hidden) -->
    <!--
    IMPORTANT SETUP INSTRUCTIONS:

    1. ADD DOMAIN TO HUBSPOT:
       - Log into your HubSpot account
       - Go to Settings > Tracking & Analytics > Tracking Code
       - Add "ai-blueprint.aimarketingpartner.com" to approved domains

    2. VERIFY TRACKING CODE:
       - Ensure Portal ID 242797301 is correct for your account
       - Check that form ID 2t_CyZSa6RnarClD9P3IyFw exists and is published

    3. TEST FORM FUNCTIONALITY:
       - Open browser developer tools (F12)
       - Watch the debug console for detailed loading information
       - Verify no CORS or security errors in browser console

    4. TROUBLESHOOTING:
       - If form doesn't load, check network tab for failed requests
       - Verify domain is properly whitelisted in HubSpot
       - Ensure form is published and publicly accessible
    -->
</body>
</html>
